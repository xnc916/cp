package com.xiongyuan.lottery.homepage.view;

import android.content.Context;
import android.content.Intent;
import android.util.AttributeSet;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Toast;

import com.xiongyuan.lottery.R;
import com.xiongyuan.lottery.homepage.activity.PKActivity;
import com.xiongyuan.lottery.homepage.model.DargChildInfo;
import com.xiongyuan.lottery.homepage.model.DragIconInfo;

import java.util.ArrayList;


public class CustomGroup extends ViewGroup  {
	private String[] title={"时时彩","11选5","官方时时彩","快乐10分","快3","PK+","低频彩"};
	private String[] content={"期期投注","中间几率更大","幸运专区","快速捞一笔","好玩又易中","百万机会",""};
	private String[] childTitlessc={"重庆时时彩","天津时时彩","新疆时时彩","分分彩","五分彩"};
	private String[] childTitlex={"广东11选5","江西11选5","山东11选5","安徽11选5","上海11选5"};
	private String[] childTitlegfssc={"北京5分彩","新加坡2分彩","加拿大3.5分彩","台湾5分彩","俄罗斯1.5分彩","新西兰45秒彩"};
	private String[] childTitleklsf={"天津快乐十分","广东快乐十分"};
	private String[] childTitlek3={"江苏快3","安徽快3","吉林快3"};
	private String[] childTitledpc={"福彩3D","排列三","排列五","上海时时乐","香港六合彩"};

	private int[] childImgssc={R.mipmap.button_icon_ssc1,R.mipmap.button_icon_ssc2,R.mipmap.button_icon_ssc3,R.mipmap.button_icon_ssc0,R.mipmap.button_icon_ssc2};
	private int[] childImgx={R.mipmap.button_icon_gd11x5,R.mipmap.button_icon_jx11x5,R.mipmap.button_icon_sd11x5,R.mipmap.button_icon_ah11x5,R.mipmap.button_icon_sh11x5};
	private int[] childImggfssc={R.mipmap.button_icon_gfssc01,R.mipmap.button_icon_gfssc02,R.mipmap.button_icon_gfssc03,R.mipmap.button_icon_gfssc04,R.mipmap.button_icon_gfssc05,R.mipmap.button_icon_gfssc06};
	private int[] childImgklsf={R.mipmap.button_icon_tj10fen,R.mipmap.button_icon_gd10};
	private int[] childImgk3={R.mipmap.kuai3_2,R.mipmap.kuai3_3,R.mipmap.kuai3_4};
	private int[] childImgdpc={R.mipmap.button_icon_fc3d,R.mipmap.button_icon_pl3,R.mipmap.button_icon_pl5,R.mipmap.button_icon_shssl,R.mipmap.button_icon_shlhc};

	private CustomAboveView mCustomAboveView;
	private CustomBehindParent mCustomBehindParent;
	private boolean isEditModel = false;
	public static final int COLUMNUM = 2;
	private Context mContext;
	//所有以的list
	private ArrayList<DragIconInfo> allInfoList = new ArrayList<DragIconInfo>();
	/**显示的带more的list*/
	private ArrayList<DragIconInfo> homePageInfoList = new ArrayList<DragIconInfo>();
	/**可展开的list*/
	private ArrayList<DragIconInfo> expandInfoList = new ArrayList<DragIconInfo>();

	/**不可展开的list*/
	private ArrayList<DragIconInfo> onlyInfoList = new ArrayList<DragIconInfo>();

	private InfoEditModelListener editModelListener;


	public interface InfoEditModelListener {
		public void onModleChanged(boolean isEditModel);
	}


	public CustomGroup(Context context, AttributeSet attrs) {
		super(context, attrs);
		this.mContext = context;
		LayoutParams upParams = new LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.WRAP_CONTENT);
		mCustomAboveView = new CustomAboveView(context, this);
		addView(mCustomAboveView, upParams);
		LayoutParams downParams = new LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.WRAP_CONTENT);
		mCustomBehindParent = new CustomBehindParent(mContext, this);
		addView(mCustomBehindParent, downParams);
		initData();
	}


	public CustomGroup(Context context) {
		this(context, null);
	}

	public InfoEditModelListener getEditModelListener() {
		return editModelListener;
	}

	public void setEditModelListener(InfoEditModelListener editModelListener) {
		this.editModelListener = editModelListener;
	}

	/**
	 *
	 * 方法: initData <p>
	 * 描述: 初始化监听和数据 <p>
	 * 参数:  <p>
	 * 返回: void <p>
	 * 异常  <p>
	 */
	private void initData() {
		setCustomViewClickListener(new CustomAboveView.CustomAboveViewClickListener() {

			@Override
			public void onSingleClicked(DragIconInfo iconInfo) {
				// TODO Auto-generated method stub
				dispatchSingle(iconInfo);
			}

			@Override
			public void onChildClicked(DargChildInfo childInfo) {
				// TODO Auto-generated method stub
				dispatchChild((childInfo));
			}
		});

		initIconInfo();
	}

	@Override
	protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
		int widthMeasure = 0;
		int heightMeasure = 0;
		if (isEditModel) {
			mCustomBehindParent.measure(widthMeasureSpec, heightMeasureSpec);
			widthMeasure = mCustomBehindParent.getMeasuredWidth();
			heightMeasure = mCustomBehindParent.getMeasuredHeight();
		} else {
			mCustomAboveView.measure(widthMeasureSpec, heightMeasureSpec);
			widthMeasure = mCustomAboveView.getMeasuredWidth();
			heightMeasure = mCustomAboveView.getMeasuredHeight();
		}
		setMeasuredDimension(widthMeasure, heightMeasure);

	}

	/**
	 * 方法: onLayout <p>
	 * 描述: TODO<p>
	 * @param changed
	 * @param l
	 * @param t
	 * @param r
	 * @param b <p>
	 * @see ViewGroup#onLayout(boolean, int, int, int, int) <p>
	 */
	@Override
	protected void onLayout(boolean changed, int l, int t, int r, int b) {
		if (isEditModel) {
			int behindHeight = mCustomBehindParent.getMeasuredHeight();
			mCustomBehindParent.layout(l, 0, r, behindHeight + t);
		} else {
			int aboveHeight = mCustomAboveView.getMeasuredHeight();
			mCustomAboveView.layout(l, 0, r, aboveHeight + t);
		}
	}

	/**
	 *
	 * 方法: initIconInfo <p>
	 * 描述: 初始化数据 <p>
	 * 参数:  <p>
	 * 返回: void <p>
	 * 异常  <p>
	 */
	private void initIconInfo() {
		allInfoList.clear();
		allInfoList.addAll(initAllOriginalInfo());
		getPageInfoList();
		refreshIconInfo();
	}

	/**
	 *
	 * 方法: initAllOriginalInfo <p>
	 * 描述: 初始化Icon info <p>
	 * 参数: @return <p>
	 * 返回: ArrayList<DragIconInfo> <p>
	 */
	private ArrayList<DragIconInfo> initAllOriginalInfo() {
		ArrayList<DragIconInfo> iconInfoList = new ArrayList<DragIconInfo>();
		ArrayList<DargChildInfo> childListssc = initChildListssc();
		ArrayList<DargChildInfo> childListx = initChildListx();
		ArrayList<DargChildInfo> childListgfssc = initChildListgfssc();
		ArrayList<DargChildInfo> childListklsf = initChildListklsf();
		ArrayList<DargChildInfo> childListk3 = initChildListk3();
		ArrayList<DargChildInfo> childListdpc = initChildListdpc();

		iconInfoList.add(new DragIconInfo(1, title[0],content[0], R.mipmap.button_icon_ssc0, DragIconInfo.CATEGORY_EXPAND, childListssc));
		iconInfoList.add(new DragIconInfo(2, title[1],content[1], R.mipmap.button_icon_11x5, DragIconInfo.CATEGORY_EXPAND, childListx));
		iconInfoList.add(new DragIconInfo(3, title[2],content[2], R.mipmap.button_icon_gfssc, DragIconInfo.CATEGORY_EXPAND, childListgfssc));
		iconInfoList.add(new DragIconInfo(4, title[3],content[3], R.mipmap.button_icon_10fen, DragIconInfo.CATEGORY_EXPAND, childListklsf));
		iconInfoList.add(new DragIconInfo(5, title[4], content[4],R.mipmap.kuai3_1, DragIconInfo.CATEGORY_EXPAND, childListk3));
		iconInfoList.add(new DragIconInfo(6, title[5],content[5], R.mipmap.button_icon_pk10_0, DragIconInfo.CATEGORY_ONLY, new ArrayList<DargChildInfo>()));
		iconInfoList.add(new DragIconInfo(7, title[6],content[6], R.mipmap.button_icon_dp, DragIconInfo.CATEGORY_EXPAND, childListdpc));
		return iconInfoList;
	}


	/**
	 *
	 * 方法: initChildList <p>
	 * 描述: 初始化child list <p>
	 * 参数: @return <p>
	 * 返回: ArrayList<DargChildInfo> <p>
	 */
	private ArrayList<DargChildInfo> initChildListssc() {
		ArrayList<DargChildInfo> childList = new ArrayList<DargChildInfo>();
		for (int i=0;i<childTitlessc.length;i++){
			childList.add(new DargChildInfo(i+1,childTitlessc[i],content[i],childImgssc[i]));
		}
		return childList;
	}
	private ArrayList<DargChildInfo> initChildListx() {
		ArrayList<DargChildInfo> childList = new ArrayList<DargChildInfo>();
		for (int i=0;i<childTitlex.length;i++){
			childList.add(new DargChildInfo(i+1,childTitlex[i],content[i],childImgx[i]));
		}
		return childList;
	}
	private ArrayList<DargChildInfo> initChildListgfssc() {
		ArrayList<DargChildInfo> childList = new ArrayList<DargChildInfo>();
		for (int i=0;i<childTitlegfssc.length;i++){
			childList.add(new DargChildInfo(i+1,childTitlegfssc[i],content[i],childImggfssc[i]));
		}
		return childList;
	}
	private ArrayList<DargChildInfo> initChildListklsf() {
		ArrayList<DargChildInfo> childList = new ArrayList<DargChildInfo>();
		for (int i=0;i<childTitleklsf.length;i++){
			childList.add(new DargChildInfo(i+1,childTitleklsf[i],content[i],childImgklsf[i]));
		}
		return childList;
	}
	private ArrayList<DargChildInfo> initChildListk3() {
		ArrayList<DargChildInfo> childList = new ArrayList<DargChildInfo>();
		for (int i=0;i<childTitlek3.length;i++){
			childList.add(new DargChildInfo(i+1,childTitlek3[i],content[i],childImgk3[i]));
		}
		return childList;
	}
	private ArrayList<DargChildInfo> initChildListdpc() {
		ArrayList<DargChildInfo> childList = new ArrayList<DargChildInfo>();
		for (int i=0;i<childTitledpc.length;i++){
			childList.add(new DargChildInfo(i+1,childTitledpc[i],content[i],childImgdpc[i]));
		}
		return childList;
	}
	/**
	 *
	 * 方法: getPageInfoList <p>
	 * 描述: 初始化显示 <p>
	 * 参数:  <p>
	 * 返回: void <p>
	 */
	private void getPageInfoList() {
		homePageInfoList.clear();
		int count = 0;
		for (DragIconInfo info : allInfoList) {
			if (count < 9) {
				homePageInfoList.add(info);
				count++;
			} else {
				break;
			}
		}
	}

	/**
	 *
	 * 方法: refreshIconInfo <p>
	 * 描述: 刷新信息 <p>
	 * 参数:  <p>
	 * 返回: void <p>
	 */
	private void refreshIconInfo() {

		ArrayList<DragIconInfo> moreInfo = getMoreInfoList(allInfoList, homePageInfoList);
		expandInfoList = getInfoByType(moreInfo, DragIconInfo.CATEGORY_EXPAND);
		onlyInfoList = getInfoByType(moreInfo, DragIconInfo.CATEGORY_ONLY);
		setIconInfoList(homePageInfoList);
	}



	/**
	 *
	 * 方法: judeHomeInfoValid <p>
	 * 描述: 判断下显示里面是否包含更多 或者看下是否是最后一个 固定更多的位置 <p>
	 * 参数:  <p>
	 * 返回: void <p>
	 */
	private void judeHomeInfoValid() {
		boolean hasMoreInfo = false;
		int posit = 0;
		for(int index = 0;index<homePageInfoList.size();index++){
			DragIconInfo tempInfo = homePageInfoList.get(index);
			if(tempInfo.getId()==CustomAboveView.MORE){
				hasMoreInfo = true;
				posit = index;
				break;
			}
		}
		if(!hasMoreInfo){
			//没有更多 增加
			//homePageInfoList.add(new DragIconInfo(CustomAboveView.MORE, "更多", R.mipmap.icon_home_more, 0, new ArrayList<DargChildInfo>()));
		}else{
			if(posit!=homePageInfoList.size()-1){
				//不是最后一个
				DragIconInfo moreInfo = homePageInfoList.remove(posit);
				homePageInfoList.add(moreInfo);
			}
		}
	}


	/**
	 *
	 * 方法: getInfoByType <p>
	 * 描述: TODO <p>
	 * 参数: @param moreInfo
	 * 参数: @param categorySpt
	 * 参数: @return <p>
	 * 返回: ArrayList<DragIconInfo> <p>
	 */
	private ArrayList<DragIconInfo> getInfoByType(ArrayList<DragIconInfo> moreInfo, int categorySpt) {
		ArrayList<DragIconInfo> typeList = new ArrayList<DragIconInfo>();
		for (DragIconInfo info : moreInfo) {
			if (info.getCategory() == categorySpt) {
				typeList.add(info);
			}
		}
		return typeList;
	}


	public void setCustomViewClickListener(CustomAboveView.CustomAboveViewClickListener gridViewClickListener) {
		mCustomAboveView.setGridViewClickListener(gridViewClickListener);
	}

	/**
	 *
	 * 方法: setIconInfoList <p>
	 * 描述: 设置信息 <p>
	 * 参数: @param iconInfoList <p>
	 * 返回: void <p>
	 * 异常  <p>
	 */
	public void setIconInfoList(ArrayList<DragIconInfo> iconInfoList) {
		mCustomAboveView.refreshIconInfoList(iconInfoList);
		mCustomBehindParent.refreshIconInfoList(iconInfoList);
	}


	public boolean isEditModel() {
		return isEditModel;
	}

	public void cancleEidtModel(){
		setEditModel(false, 0);
	}


	public void setEditModel(boolean isEditModel, int position) {
		this.isEditModel = isEditModel;
		if (isEditModel) {
			mCustomAboveView.setViewCollaps();
			mCustomAboveView.setVisibility(View.GONE);
			mCustomBehindParent.notifyDataSetChange(mCustomAboveView.getIconInfoList());
			mCustomBehindParent.setVisibility(View.VISIBLE);
			mCustomBehindParent.drawWindowView(position, mCustomAboveView.getFirstEvent());
		} else {
			homePageInfoList.clear();
			homePageInfoList.addAll(mCustomBehindParent.getEditList());
			mCustomAboveView.refreshIconInfoList(homePageInfoList);
			mCustomAboveView.setVisibility(View.VISIBLE);
			mCustomBehindParent.setVisibility(View.GONE);
			if(mCustomBehindParent.isModifyedOrder()){
				mCustomBehindParent.cancleModifyOrderState();
			}
			mCustomBehindParent.resetHidePosition();
		}
		if(editModelListener!=null){
			editModelListener.onModleChanged(isEditModel);
		}
	}


	public void sendEventBehind(MotionEvent ev) {
		mCustomBehindParent.childDispatchTouchEvent(ev);
	}

	/**
	 *
	 * 方法: getMoreInfoList <p>
	 * 描述: TODO <p>
	 * 参数: @param allInfoList
	 * 参数: @param homePageInfoList
	 * 参数: @return <p>
	 * 返回: ArrayList<DragIconInfo> <p>
	 */
	private ArrayList<DragIconInfo> getMoreInfoList(ArrayList<DragIconInfo> allInfoList, ArrayList<DragIconInfo> homePageInfoList) {
		ArrayList<DragIconInfo> moreInfoList = new ArrayList<DragIconInfo>();
		moreInfoList.addAll(allInfoList);
		moreInfoList.removeAll(homePageInfoList);
		return moreInfoList;
	}



	/**
	 *
	 * 方法: deletHomePageInfo <p>
	 * 描述: TODO <p>
	 * 参数: @param dragIconInfo <p>
	 * 返回: void <p>
	 */
	public void deletHomePageInfo(DragIconInfo dragIconInfo) {
		homePageInfoList.remove(dragIconInfo);
		mCustomAboveView.refreshIconInfoList(homePageInfoList);
		int category = dragIconInfo.getCategory();
		switch (category) {
			case DragIconInfo.CATEGORY_ONLY:
				onlyInfoList.add(dragIconInfo);
				break;
			case DragIconInfo.CATEGORY_EXPAND:
				expandInfoList.add(dragIconInfo);
				break;
			default:
				break;
		}
		allInfoList.remove(dragIconInfo);
		allInfoList.add(dragIconInfo);
	}




	/**
	 *
	 * 方法: dispatchChild <p>
	 * 描述: 点击child <p>
	 * 参数: @param childInfo <p>
	 * 返回: void <p>
	 */
	protected void dispatchChild(DargChildInfo childInfo) {
		if (childInfo == null) {
			return;
		}
		Toast.makeText(mContext, "点击了item"+childInfo.getName(), Toast.LENGTH_SHORT).show();

	}


	/**
	 *
	 * 方法: dispatchSingle <p>
	 * 描述: 没child的点击 <p>
	 * 参数: @param dragInfo <p>
	 * 返回: void <p>
	 */
	public void dispatchSingle(DragIconInfo dragInfo) {
		if (dragInfo == null) {
			return;

		}
		Intent intent=new Intent(mContext,PKActivity.class);
		mContext.startActivity(intent);
	}




	public boolean isValideEvent(MotionEvent ev, int scrolly) {
		return mCustomBehindParent.isValideEvent(ev,scrolly);
	}


	public void clearEditDragView() {
		mCustomBehindParent.clearDragView();
	}


}
